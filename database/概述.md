[toc]

# 2. 
## E-R模型
属性：
- 
联系：
- 实体集的映射关系(二元以及多元)
- 单个实体集内部的联系: 班长
- 多个: 工厂,产品, 用户
- 相同实体的多种联系: 职工的上下级和同事关系
- 联系不一定都是满射
- 联系本身的属性: 学习关系 $\rightarrow$ (学生 课程 成绩), (借阅: 书, 学生, 归还日期)
属性的描述:
- 属性名, 域
实体:
- 元组: 各属性值的集合 tuple
- 关键字属性: 工号, 身份证号等可以唯一确定实体的属性 $\rightarrow$ 主关键字, 候选关键字
联系:
- 
E-R图
- 属性不能单独存在
- 线段两端注明对应关系 : 1:1, 1:m
- 建模:
	- 需要进一步描述多方面的信息, 可以持久的存在: 实体
	- 单一的描述值: 属性 联系的属性会随着联系的消失而消失
	- 与多个对象有关: 联系
	- 多元联系可以用多个二元联系来表示
## EER模型

-  IS-A联系
- 超实体集- 子实体集(子集的实体包含的属性更多)
- 弱实体集: 如家属, 家长 $\rightarrow$ 一般是多对一, 要依附于其他实体存在 到联系的有向箭头
关系模型:
	- 数据操纵: 一张表对多张表的查询
- 二维表的关系
	- 同一表中属性名不同
	- 表中的元组均不相同
	- 排列次序无关
	- 每一分量都是不可分割的基本数据项 $\rightarrow$ 不可再分割
	- 每一个关系都有关键字

## 关系数据库
- 二维表
	- 结构简单
	- 使用方便：不涉及物理结构，非过程性数据子语言(封装较好）
	- 功能较强：方便修改，存取路径灵活，
	- 独立性高：不涉及物理因素
	![输入图片说明](/imgs/2024-03-11/p7LsbamoZXb8gr7f.png)
	- 元组唯一，但是实现时可以重复
	- 外键的两张表可以重合，外键可以为空但是不能不存在
	- 两个外键可以联合构成候选键
	- 外键可以引用自身
	![输入图片说明](/imgs/2024-03-20/HSw7IGkkUTZPOihW.png)
	


	![输入图片说明](/imgs/2024-03-20/LkA4Gm9ZcuQrIPCE.png)
	**关系操纵**
	- 查询
		- 单张： 纵向定位，横向定位
		- 多张表的数据查询：先合并成一张表，再进行查询
	- 增加
	- 删除：不能跨表删除
	- 修改：先删除再插入
	**空值**
	- 主键不能是空值
	- 运算中出现，结果就是空值
	- 逻辑运算中就为假
	- 统计计算中
		- 空集做sum, avg, max, min操作时结果为空
		- count操作时统计结果为0，
	- 投影时重复的元组会合并
		![111](/imgs/2024-03-11/2q2CeZNm0KnxlxNz.png)
		$\Pi_{c.name,c.city,a.name} \sigma_{c.city=a.city}(R*C)$
- 笛卡尔乘积时要进行换名

- 除法运算中会进行合并操作
![输入图片说明](/imgs/2024-03-18/mFRIvcelMYkEztt9.png)
则需要先把有关系的列单独投影出来

**联结**
- 外联结就是将无法联结的内容补充到表中，剩余值用null代替
- 联结时遇到可能存在重复的值要慎重考虑，可能会漏选情况

## SQL语言
- distinct 只在select中可以使用，用于删除重复的数据

- 注意，视图并不存在与数据库中，只保留了构造信息 

![输入图片说明](/imgs/2024-04-01/DipM7JKexJWlEPcj.png)

- 修改例如平均值这样的属性是不被允许的
- WITH CHECK OPTION表示对视图进行UPDATE、INSERT和DELETE操作时，要保证更新、插入或删除的行满足视图定义中的谓词条件（即子查询中的条件表达式）

## 事务的性质
**原子性**
**一致性**
开始和结束时数据库都要处于一致的状态
**隔离性**
**持久性**：redo（重做）日志
![ACID](/imgs/2024-04-08/lvJfwadiNpj8IcO2.png)
死锁：两个文件相互访问对方的数据

- 不可重复是针对记录的更新操作，只要在记录上加写锁，就可避免；幻读是对记录的插入操作，要禁止幻读必须加上全局的写锁（比如在表上加写锁）。
- 并发控制仅考虑事务要访问的元组是不够的，还需要考虑事务用于找到待访问元组的信息。

- write 不一定就含有output操作
- **调度**：不同事务间的执行顺序，主要关心以什么样的顺序来读写内存缓冲区的数据

**冲突操作**：是不同事务对于同一个数据的读写和写写操作，同一事务的相邻操作是冲突

**冲突可串行化**：如果一个调度中更换不冲突的操作的顺序能得到一个串行的结果，就是冲突可串行化的。
ps: 冲突可串行化是可串行化的充分条件

![输入图片说明](/imgs/2024-04-15/7UPSe0nfodQkEO9l.png)

![输入图片说明](/imgs/2024-04-22/aI6Elclb1KWMsm9R.png)
这里的IX时请求IS在上层是兼容的，在下层要进行进一步的判断是否可以进行操作

![输入图片说明](/imgs/2024-05-05/fKvCIj5i017oOwpd.png)


![输入图片说明](/imgs/2024-04-22/Zo6mY5vb73Cu5z95.png)
最后还有flush log记录commit T
稠密索引：每个记录对应一个索引


# 规范化理论
- 水平规范化：通过选择和并，将元组集合分成不同的元组
- 竖直规范化：通过投影和联结运算，将属性集合分成不同的属性集
![输入图片说明](/imgs/2024-05-21/gbnFd6CeHdQ8zOJt.png)
不能有$x \rightarrow x$, 否则就是平凡的函数依赖

![输入图片说明](/imgs/2024-05-21/QBBPEHTfY2BHyKOm.png)
[【通俗易懂】关系模式范式分解教程 3NF与BCNF口诀!小白也能看懂-CSDN博客](https://blog.csdn.net/sumaliqinghua/article/details/86246762)
[三张图搞透第一范式(1NF)、第二范式(2NF)和第三范式(3NF)的区别 - 菜鸟的飞翔梦 - 博客园 (cnblogs.com)]
[数据库三范式和BCNF范式的理解：生动举例-CSDN博客](https://blog.csdn.net/weixin_43954951/article/details/125494783)(https://www.cnblogs.com/HanJie0824/p/14718027.html)

单实体集内部的联系，按照二元关系处理，然后合并成一个关系
如果结果是三张表的话合并成两张表，即实体本身和关系

有继承关系的话
![输入图片说明](/imgs/2024-06-02/UQmGhVbvdTue7kLS.png)
最后默认满足到3NF至少



<!--stackedit_data:
eyJoaXN0b3J5IjpbNTM3ODQwNDg3LC0xOTA5OTM0MjE1LC0xMT
I1MzU4MTMzLDcyMjUyNzI3NCwtMTQ2ODM1MDA4MiwtMTc5MzE2
NjI3OSw2MDIzOTg3MTcsLTIwOTAyMjE2OTgsLTE4OTQ3OTE4NT
YsLTE2OTg3OTQ3MzksLTMzOTA3OTAwOSwtNjA1ODIwMjM5LC0x
NzA5MDQ0MDEyLC0xNDg1MDE3NDA1LDE3MDkzMDUzNSwxNjU4MT
E5ODM0LDYzODcxNDczMiw5OTY1NzczNiwyMDUzODUxMjI2LDY3
MjQ1NDg4OV19
-->